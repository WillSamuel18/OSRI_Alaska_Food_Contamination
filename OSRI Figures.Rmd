---
title: "OSRI.Figures"
output: html_document
date: "2025-08-28"
editor_options: 
  chunk_output_type: console
---
To Do
Get Awesome color palette
Order taxa and evt. regions
```{r setup, include=FALSE}

library(viridis)
library(ggstream)

D18<-read_xlsx("OSRI_Totals_Full_Aug28.xlsx")
##Figure 1 - Data in Analysis- Ridge plot chart or area density chart with Time on x-axis and samples reported on y, colors are studies, hues are databases? Too much?
#####

all_years <- unique(D18$Year_clean)
all_studies <- unique(D18$Study_name_cleaner)
complete_grid <- expand.grid(Year_clean = all_years, Study_name_cleaner = all_studies)

summary_df <- D18 %>%
  group_by(Year_clean, Study_name_cleaner) %>%
  summarise(Count = n(), .groups = "drop")

summary_df_complete <- complete_grid %>%
  left_join(summary_df, by = c("Year_clean", "Study_name_cleaner")) %>%
  mutate(Count = replace_na(Count, 0)) %>%
  arrange(Year_clean, Study_name_cleaner)

summary_cumulative <- summary_df_complete %>%
  group_by(Study_name_cleaner) %>%
  arrange(Year_clean) %>%
  mutate(CumulativeCount = cumsum(Count)) %>%
  ungroup()%>%
  mutate(
    Year_clean=as.numeric(Year_clean)
  )

# Plot
ggplot(summary_cumulative, aes(x = Year_clean, y = Count, group = Study_name_cleaner, fill= Study_name_cleaner)) +
  geom_stream(color = "white", size = 0.1, alpha = 0.9,type = "ridge", bw=1) +
  scale_fill_viridis_d(name = "Study",option = "D") +
  theme_minimal(base_size = 13) +
  labs(
    title = "",
    x= "",
    y = "Number of Observations") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = c(1.025, 1.10),  # Position legend inside plot (x, y from bottom-left)
    legend.justification = c("right", "top"),  # Anchor the legend box
    legend.background = element_blank(),   # transparent background
    legend.box.background = element_blank(),  # remove outer box
    legend.key = element_blank(),           # transparent boxes behind keys
    legend.title = element_text(face = "bold"))

ggsave(filename = "Figures/Fig1-ObservationsByStudyOverTime.png",    # output file name
  plot = last_plot(),                   # or specify your plot object like `my_plot`
  device = "png",
  width = 8.5,                          # half of standard 11-inch paper width
  height = 5.5,                         # full height of standard paper
  units = "in",
  dpi=300)
#####

##Figure 2a - Pie chart of taxa and observations with list of species under each label
library(ggrepel)

taxa_summary <- D18 %>%
  group_by(Layman_group, Common_name) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Layman_group) %>%
  summarise(
    TotalCount = sum(Count),
    SpeciesList = paste(unique(Common_name), collapse = ", "),
    .groups = "drop"
  ) %>%
  arrange(desc(TotalCount)) %>%
  mutate(
    Fraction = TotalCount / sum(TotalCount),
    ymax = cumsum(Fraction),
    ymin = lag(ymax, default = 0),
    label_pos = (ymax + ymin) / .1,
    Label = paste0(Layman_group, "\n(n=", TotalCount, ")") )

#Plot
ggplot(taxa_summary, aes(x = "", y = TotalCount, fill = Layman_group)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_viridis_d(name = "Taxonomic Group") +

geom_text(
    aes(x = 1, y = (label_pos), label = Label),
    color = "white", size = 3, fontface = "bold"
  ) +
  geom_label_repel(  # External species annotation
    aes(x = 2, y = label_pos, label = SpeciesList, fill = Layman_group),
    size = 3,
    color = "black",
    box.padding = 0.4,
    segment.size = 0.3,
    segment.color = "grey50",
    label.size = 0.2,
    max.overlaps=50,
    show.legend = FALSE
  ) + theme(legend.position = "none")

ggsave(filename = "Figures/Fig2a-SpeciesObservationsBreakdown.png",    # output file name
  plot = last_plot(),                   # or specify your plot object like `my_plot`
  device = "png",
  width = 8.5,                          # half of standard 11-inch paper width
  height = 5.5,                         # full height of standard paper
  units = "in",
  dpi=300)

#2b- 

#Figure 3 - Boxplots of Taxa and all observations Total PAHs
ggplot(data=D17, aes(x = `Layman_group`, y = log(`Total_PAH`), color = `Layman_group`)) +
  geom_boxplot(outlier.shape = NA) +  # Removes the outlier markers from the boxplot
  geom_jitter(aes(color = `Layman_group`), 
              width = 0.2, height = 0, size = 1, alpha = 0.5) +  # Add jittered points
  labs(title = "PAH concentrations measured in marine organisms", x = "", y = "log(Total PAHs (ng/g))") +
  theme_minimal() +
  theme(
    legend.position = "none",  # Removes the legend
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis text
  )

#Figure 4 - Panel break down of Fish, inverts, and marine mammal by species_standard

#Figure 5- Time and total PAHs, paneled by taxa - point and line

#Figure 6 - Sample Motivation by Total PAHs by taxa - comparative boxplots

#Figure 7 - Number of samples for each taxa by region

#Figure 8 - Mussels over time and region, line and point plots

#Figure 9 - Data Quality - # of observations reporting lab flags, detection limits, Number of observation BDL, reporting tissue type, pct moisture

#Figure 10 - By taxa number of observations reporting wet vs dry and provided or calculated Total PAH levels, range of PAH number and distribution going into Total_PAH calculations

#Figure 11 - Subsistence gaps, by region marine subsistence resources harvested compared to numbers of observations

```

